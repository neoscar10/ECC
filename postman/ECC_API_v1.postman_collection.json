{
    "info": {
        "_postman_id": "ecc-api-v1-restored-flow",
        "name": "ECC API v1",
        "description": "# ECC API v1\n\n**Base URL:** `{{base_url}}/{{api_prefix}}`\n\n## Overview\nAuthentication: **Bearer Token (JWT)**\n- Obtain via `/auth/register` or `/auth/login`.\n\n## Flow\n1. **Auth**: Register/Login, then Request/Verify OTP.\n2. **Membership Application**:\n   - Get Current Application\n   - Update Details -> Cricket Profile -> Collector Intent\n   - Select Tier -> Payment -> Submit\n3. **Admin**: Approval flow.\n\n## Response Envelope\nAll responses follow:\n```json\n{\n  \"success\": true,\n  \"message\": \"...\",\n  \"data\": { ... },\n  \"meta\": ...,\n  \"errors\": ...\n}\n```",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "auth": {
        "type": "bearer",
        "bearer": [
            {
                "key": "token",
                "value": "{{jwt_token}}",
                "type": "string"
            }
        ]
    },
    "item": [
        {
            "name": "Auth",
            "description": "Handles User Registration, Login, Token Management, and Phone OTP Verification.",
            "item": [
                {
                    "name": "01 Register",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.success && jsonData.data.access_token) {",
                                    "    pm.environment.set(\"jwt_token\", jsonData.data.access_token);",
                                    "}",
                                    "if (jsonData.success && jsonData.data.application && jsonData.data.application.id) {",
                                    "    pm.environment.set(\"application_id\", jsonData.data.application.id);",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "noauth"
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Test User\",\n    \"email\": \"test@example.com\",\n    \"phone\": \"+1234567890\",\n    \"password\": \"password\",\n    \"password_confirmation\": \"password\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/auth/register",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "auth",
                                "register"
                            ]
                        },
                        "description": "Register a new user and start a membership application.\n\n**Auth:** None\n\n**Body:**\n- `name`, `email`, `phone`, `password`, `password_confirmation`\n\n**Response:**\n- `access_token` (JWT)\n- `application` object (ID used in subsequent requests)"
                    },
                    "response": []
                },
                {
                    "name": "02 Request Phone OTP",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"phone\": \"+1234567890\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/auth/request-otp",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "auth",
                                "request-otp"
                            ]
                        },
                        "description": "Request an OTP for phone verification.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)\n\n**Body:**\n- `phone`: International format preferred."
                    },
                    "response": []
                },
                {
                    "name": "03 Verify Phone OTP",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"phone\": \"+1234567890\",\n    \"otp\": \"123456\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/auth/verify-otp",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "auth",
                                "verify-otp"
                            ]
                        },
                        "description": "Verify the OTP sent to the user's phone.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)\n\n**Body:**\n- `phone`\n- `otp`: The code received (Dummy: `123456`)"
                    },
                    "response": []
                },
                {
                    "name": "04 Login",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.success && jsonData.data.access_token) {",
                                    "    pm.environment.set(\"jwt_token\", jsonData.data.access_token);",
                                    "}",
                                    "if (jsonData.success && jsonData.data.application && jsonData.data.application.id) {",
                                    "    pm.environment.set(\"application_id\", jsonData.data.application.id);",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "noauth"
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"test@example.com\",\n    \"password\": \"password\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "auth",
                                "login"
                            ]
                        },
                        "description": "Login existing user.\n\n**Auth:** None\n\n**Body:**\n- `email`\n- `password`\n\n**Response:**\n- `access_token`\n- `user` details"
                    },
                    "response": []
                },
                {
                    "name": "05 Me",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/auth/me",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "auth",
                                "me"
                            ]
                        },
                        "description": "Get current authenticated user details.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)"
                    },
                    "response": []
                },
                {
                    "name": "06 Refresh Token",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.success && jsonData.data.access_token) {",
                                    "    pm.environment.set(\"jwt_token\", jsonData.data.access_token);",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/auth/refresh",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "auth",
                                "refresh"
                            ]
                        },
                        "description": "Refresh the current JWT token.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)\n\n**Response:**\n- New `access_token`"
                    },
                    "response": []
                },
                {
                    "name": "07 Logout",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/auth/logout",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "auth",
                                "logout"
                            ]
                        },
                        "description": "Invalidate the current token.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "Membership Applications",
            "description": "Step-by-step membership application flow.\n\n**Prerequisites:** User must be registered and authenticated (`{{application_id}}` required for most steps).",
            "item": [
                {
                    "name": "01 Get Current Application",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.success && jsonData.data.id) {",
                                    "    pm.environment.set(\"application_id\", jsonData.data.id);",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/membership-application/current",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "membership-application",
                                "current"
                            ]
                        },
                        "description": "Retrieve the active membership application for the user.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)\n\n**Response:** Sets `{{application_id}}` in environment."
                    },
                    "response": []
                },
                {
                    "name": "02 Update Personal Details",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"full_name\": \"Test User\",\n    \"date_of_birth\": \"1990-01-01\",\n    \"country\": \"India\",\n    \"city\": \"Mumbai\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/membership-applications/{{application_id}}/personal-details",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "membership-applications",
                                "{{application_id}}",
                                "personal-details"
                            ]
                        },
                        "description": "Update personal details for the application.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)\n\n**Body:**\n- `full_name`, `date_of_birth`, `country`, `city`"
                    },
                    "response": []
                },
                {
                    "name": "03 Update Cricket Profile",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"preferred_formats\": [\"TEST\", \"ODI\", \"T20\"],\n    \"eras\": [\"ODI_90S_ERA\", \"MODERN_ERA\"]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/membership-applications/{{application_id}}/cricket-profile",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "membership-applications",
                                "{{application_id}}",
                                "cricket-profile"
                            ]
                        },
                        "description": "Update cricket preferences.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)\n\n**Body:**\n- `preferred_formats` (Array of Codes via Meta API)\n- `eras` (Array of Codes via Meta API)"
                    },
                    "response": []
                },
                {
                    "name": "04 Submit Collector Intent (Triggers Rec)",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"has_acquired_memorabilia_before\": true,\n    \"focus\": \"RARITY\",\n    \"investment_horizon\": \"Y10_PLUS\",\n    \"interests\": [\"Match Worn Gear\", \"Autographs\"]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/membership-applications/{{application_id}}/collector-intent",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "membership-applications",
                                "{{application_id}}",
                                "collector-intent"
                            ]
                        },
                        "description": "Submit collecting habits. **Triggers Tier Recommendation Engine**.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)\n\n**Body:**\n- `has_acquired_memorabilia_before` (boolean)\n- `focus` (Code)\n- `investment_horizon` (Code)\n- `interests` (Array)\n\n**Response:**\n- `recommended_tier` object"
                    },
                    "response": []
                },
                {
                    "name": "05 Select Tier",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"tier_id\": 3\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/membership-applications/{{application_id}}/select-tier",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "membership-applications",
                                "{{application_id}}",
                                "select-tier"
                            ]
                        },
                        "description": "Lock in the selected membership tier.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)\n\n**Body:**\n- `tier_id` (Integer)"
                    },
                    "response": []
                },
                {
                    "name": "06 Confirm Payment",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"method\": \"card\",\n    \"amount\": 50000,\n    \"cardholder_name\": \"Test User\",\n    \"last4\": \"4242\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/membership-applications/{{application_id}}/payment/confirm",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "membership-applications",
                                "{{application_id}}",
                                "payment",
                                "confirm"
                            ]
                        },
                        "description": "Confirm payment (Mock/Stripe integration).\n\n**Auth:** Bearer Token (`{{jwt_token}}`)\n\n**Body:**\n- `method`\n- `amount`\n- `cardholder_name`\n- `last4`"
                    },
                    "response": []
                },
                {
                    "name": "07 Submit Application",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/membership-applications/{{application_id}}/submit",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "membership-applications",
                                "{{application_id}}",
                                "submit"
                            ]
                        },
                        "description": "Final application submission. Marks application as submitted and awaiting approval/activation.\n\n**Auth:** Bearer Token (`{{jwt_token}}`)"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "Membership Tiers",
            "description": "Browse available membership tiers.",
            "item": [
                {
                    "name": "List Tiers",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/membership-tiers",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "membership-tiers"
                            ]
                        },
                        "description": "List all active membership tiers.\n\n**Auth:** Bearer Token (`{{jwt_token}}`) - Inherited"
                    },
                    "response": []
                },
                {
                    "name": "Get Tier Details",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/membership-tiers/1",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "membership-tiers",
                                "1"
                            ]
                        },
                        "description": "Get detailed info for a specific tier.\n\n**Auth:** Bearer Token (`{{jwt_token}}`) - Inherited"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "Membership Status",
            "description": "Check current membership status.",
            "item": [
                {
                    "name": "Get Status",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/membership/status",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "membership",
                                "status"
                            ]
                        },
                        "description": "Check the status of the user's membership (Active, Pending, Rejected, None).\n\n**Auth:** Bearer Token (`{{jwt_token}}`)"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "Meta",
            "description": "Helper endpoints for UI options.",
            "item": [
                {
                    "name": "Get Cricket Profile Options",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/meta/cricket-profile-options",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "meta",
                                "cricket-profile-options"
                            ]
                        },
                        "description": "Get Code/Label pairs for Cricket Profile (Formats, Eras).\n\n**Auth:** None"
                    },
                    "response": []
                },
                {
                    "name": "Get Collector Intent Options",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/meta/collector-intent-options",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "meta",
                                "collector-intent-options"
                            ]
                        },
                        "description": "Get Code/Label pairs for Collector Intent (Focus, Horizon).\n\n**Auth:** None"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "Admin",
            "description": "Administrative actions.",
            "item": [
                {
                    "name": "Broadcast Test",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/admin/broadcast/test",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "admin",
                                "broadcast",
                                "test"
                            ]
                        },
                        "description": "Trigger a test broadcast event.\n\n**Auth:** Bearer Token (`{{jwt_token}}`) - Admin Role Required"
                    },
                    "response": []
                },
                {
                    "name": "Approve Membership",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/admin/memberships/1/approve",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "admin",
                                "memberships",
                                "1",
                                "approve"
                            ]
                        },
                        "description": "Approve a pending membership.\n\n**Auth:** Bearer Token (`{{jwt_token}}`) - Admin Role Required"
                    },
                    "response": []
                },
                {
                    "name": "Reject Membership",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{jwt_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"reason\": \"Incomplete application\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/{{api_prefix}}/admin/memberships/1/reject",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "{{api_prefix}}",
                                "admin",
                                "memberships",
                                "1",
                                "reject"
                            ]
                        },
                        "description": "Reject a pending membership.\n\n**Auth:** Bearer Token (`{{jwt_token}}`) - Admin Role Required\n\n**Body:**\n- `reason`"
                    },
                    "response": []
                }
            ]
        }
    ]
}